---
- name: redis tasks
  hosts: all
  vars:
    target_env: "{{ lookup('env', 'target') }}"
  roles:
  - role: caddy-1.0.6
    vars:
      caddy_plugins: upload
  - role: set-timezone
    vars:
      timezone: "Asia/Shanghai"
  - disable-motd
  - iputils
  - appctl
  - role: app-agent
    app_agent_version: "1.0.7"
    app_agent_arch: "arm64"
  - jq
  - role: redis-server
    vars:
      version: "{{ redis_version }}"

- name: redis standalone
  hosts: redis-standalone
  tasks:
  - include_role:
      name: "{{ name }}"
    loop:
    - redis-standalone
    - node-exporter-0.18.1
    - redis-exporter
    loop_control:
      loop_var: name

- name: redis cluster
  hosts: redis-cluster
  tasks:
  - include_role:
      name: "{{ name }}"
    loop:
    - redis-cluster
    - node-exporter-0.18.1
    - redis-exporter
    loop_control:
      loop_var: name

- name: online-setup 
  hosts: online-setup 
  tasks:
  - include_role:
      name: "online-setup"
